syntax = "proto3";

package cloudeko.kama.identity.v1;

import "google/api/field_behavior.proto";
import "google/api/field_info.proto";
import "google/api/resource.proto";

import "google/protobuf/timestamp.proto";

// ----------------------------------------------------------------------------
// Identity Resource Model
// ----------------------------------------------------------------------------
// This file defines the public resource model for identity and user management 
// in the Kama platform. Users represent individual accounts with authentication
// credentials, profile information, and role-based access control.
//
// Key concepts:
// - Resource name: Each user has a stable resource name in the form
//   "users/{user}" and an immutable UUID4 id generated by the server.
// - Authentication: Users authenticate with email/password credentials.
//   Passwords are stored as secure hashes using bcrypt.
// - Authorization: Users are assigned roles that define their permissions
//   within the system. Roles can be customized per deployment.
// - Sessions: JWT tokens are issued for authenticated sessions with
//   configurable expiration times.
// - Profile: Users have basic profile information including display name
//   and email verification status.
// - Timestamps: Server-populated create_time and update_time track the user
//   lifecycle.
//
// Backward-compatibility guidelines for evolving this API:
// - Only add new optional fields; do not remove or repurpose existing tags.
// - Do not change wire types of existing fields.
// - Prefer adding new enum values to the end. Document behavior of unknown
//   values on clients.
//
// Example (YAML-like) representation of a User:
//   id: "8d1b9b6a-2f5f-4d1f-8c2c-b5a9ad5e2f5e"
//   name: "users/8d1b9b6a-2f5f-4d1f-8c2c-b5a9ad5e2f5e"
//   email: "user@example.com"
//   display_name: "John Doe"
//   email_verified: true
//   active: true
//   roles: ["users/user"]
//
// Unless specified otherwise, strings are UTF-8. All server-populated fields are
// marked OUTPUT_ONLY and must be ignored on input.

option java_multiple_files = true;
option java_outer_classname = "IdentityResourcesProto";
option java_package = "dev.cloudeko.kama.identity.v1";
option csharp_namespace = "Cloudeko.Kama.Identity.V1";
option go_package = "cloudeko.dev/go/kama/identity/v1/identitypb;identitypb";
option php_namespace = "Cloudeko\\Kama\\Identity\\V1";
option ruby_package = "Cloudeko::Kama::Identity::V1";

// A user account in the system.
message User {
  option (google.api.resource) = {
    type: "kama.cloudeko.dev/User"
    pattern: "users/{user}"
    singular: "user"
    plural: "users"
  };

  // Output only. A universally unique identifier (UUID) for the user in
  // the UUID4 format. This identifier is generated by the server.
  // Example: "8d1b9b6a-2f5f-4d1f-8c2c-b5a9ad5e2f5e"
  string id = 1 [
    (google.api.field_info).format = UUID4,
    (google.api.field_behavior) = OUTPUT_ONLY
  ];

  // Output only. The resource name of the user in the canonical format.
  // Format: users/{user}
  // Example: "users/8d1b9b6a-2f5f-4d1f-8c2c-b5a9ad5e2f5e"
  string name = 2 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Required. The user's email address, used for authentication and notifications.
  // Must be a valid email address format and unique across all users.
  string email = 3 [(google.api.field_behavior) = REQUIRED];

  // Optional. Human-readable display name for the user.
  // Recommended length: <= 256 characters.
  string display_name = 4 [(google.api.field_behavior) = OPTIONAL];

  // Output only. Whether the user's email address has been verified.
  bool email_verified = 5 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. Whether the user account is active. Inactive users cannot
  // authenticate or access the system.
  bool active = 6 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The roles assigned to this user. Each role defines a set of
  // permissions that determine what actions the user can perform.
  repeated string roles = 7 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The last time this user was updated (server time).
  google.protobuf.Timestamp update_time = 80 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. When this user was created (server time).
  google.protobuf.Timestamp create_time = 81 [(google.api.field_behavior) = OUTPUT_ONLY];
}

// A role that can be assigned to users to grant permissions.
message Role {
  option (google.api.resource) = {
    type: "kama.cloudeko.dev/Role"
    pattern: "roles/{role}"
    singular: "role"
    plural: "roles"
  };

  // Output only. A universally unique identifier (UUID) for the role in
  // the UUID4 format. This identifier is generated by the server.
  string id = 1 [
    (google.api.field_info).format = UUID4,
    (google.api.field_behavior) = OUTPUT_ONLY
  ];

  // Output only. The resource name of the role in the canonical format.
  // Format: roles/{role}
  string name = 2 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Required. A unique identifier for the role (e.g., "admin", "user", "viewer").
  // Must match ^[a-zA-Z][a-zA-Z0-9_-]*$ for portability.
  string role_name = 3 [(google.api.field_behavior) = REQUIRED];

  // Optional. Human-readable description of what this role provides.
  string description = 4 [(google.api.field_behavior) = OPTIONAL];

  // Required. List of permissions granted by this role.
  // Permissions are strings that define what actions users with this role can perform.
  // Examples: "read:collections", "write:records", "*" (all permissions)
  repeated string permissions = 5 [(google.api.field_behavior) = REQUIRED];

  // Output only. The last time this role was updated (server time).
  google.protobuf.Timestamp update_time = 80 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. When this role was created (server time).
  google.protobuf.Timestamp create_time = 81 [(google.api.field_behavior) = OUTPUT_ONLY];
}

// An authentication session for a user.
message Session {
  option (google.api.resource) = {
    type: "kama.cloudeko.dev/Session"
    pattern: "users/{user}/sessions/{session}"
    singular: "session"
    plural: "sessions"
  };

  // Output only. A universally unique identifier (UUID) for the session in
  // the UUID4 format. This identifier is generated by the server.
  string id = 1 [
    (google.api.field_info).format = UUID4,
    (google.api.field_behavior) = OUTPUT_ONLY
  ];

  // Output only. The resource name of the session in the canonical format.
  // Format: users/{user}/sessions/{session}
  string name = 2 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The user this session belongs to.
  // Format: users/{user}
  string user = 3 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. JWT token for this session.
  string token = 4 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. When this session expires.
  google.protobuf.Timestamp expires_at = 5 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. IP address from which the session was created.
  string ip_address = 6 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. User agent string from the client that created this session.
  string user_agent = 7 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. Whether this session is still active.
  bool active = 8 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. The last time this session was updated (server time).
  google.protobuf.Timestamp update_time = 80 [(google.api.field_behavior) = OUTPUT_ONLY];

  // Output only. When this session was created (server time).
  google.protobuf.Timestamp create_time = 81 [(google.api.field_behavior) = OUTPUT_ONLY];
}